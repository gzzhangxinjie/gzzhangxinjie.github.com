---
layout: post
title: "pptp安装与配置"
description: "本文描述了在 Debian 7上安装与配置 PPTP，以及如何在 mac os x 上设置路由。"
category: pptp, vpn
tags: [pptp, debian, 路由, vpn]
---
{% include JB/setup %}

生命在于折腾，在 vps 上面搭建 openvpn 之后，总是不稳定，时常连接不上；一怒之下，换成 pptp。

##pptp 搭建

搭建环境：debian 7， xvmlabs vps

1. 安装 ppp

    ~~~
    apt-get install pptpd
    ~~~

2. 配置 pptp

    编辑 `/etc/pptpd.con`文件：
 
    ~~~
    localip 192.0.0.1
    remoteip 192.168.0.234-238,192.168.0.245
    ~~~
 
    把这两行前面的`#`去掉，localip 是代表 vpn 本地的 ip，remoteip 是代表分配给远程连接 pptp 机器的 ip。

3. 设置 dns

    编辑`/etc/ppp/options/`, `/etc/ppp/pptpd-options`文件，去掉`ms-dns`前面的`#`，并修改成：

    ~~~
    ms-dns 8.8.8.8
    ms-dns 8.8.4.4
    ~~~

4. 设置pptp VPN 账号

    编辑 `/etc/ppp/chap-secrets`文件，

    ~~~
    username pptpd password ipaddress
    ~~~
    第一个是用户名，第三个是密码，第四个是 ip 地址，也可以使用`*`号，表示这个用户在所有 ip 地址情况下都可以使用。

5. 修改系统配置
    
    编辑`/etc/sysctl.conf`文件，设置成:
    
    ~~~
    net.ipv4.ip_forward=1
    net.ipv4.conf.all.accept_redirects = 0
    net.ipv4.conf.default.accept_redirects = 0
    net.ipv4.conf.all.send_redirects = 0
    net.ipv4.conf.default.send_redirects = 0
    ~~~

6. 添加防火墙转发规则

    ~~~
    iptables -t nat -A POSTROUTING -s 192.168.0.0/24 -o venet0 -j SNAT --to-source vps地址
    ~~~
    其中, `venet0`是转发的网络端口，vps地址是 vps 的公网 ip 地址, `192.168.0.0/24`要跟第二步中的网段匹配。

7. 重启服务

    ~~~
    /etc/init.d/networking restart
    /etc/init.d/pptpd restart
    ~~~
