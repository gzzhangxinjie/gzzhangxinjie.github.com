---
layout: post
title: "Django自定义模板标签和过滤器"
description: ""
category: django
tags: ["django", "tags", "custom tags", "filters", "custom filters"]
---
{% include JB/setup %}

尽管Django模板系统自带了很多内置的标签和过滤器，但是在特殊的情况下，我们还是会觉得不够用，在这个时候，我们就需要用到模板的自定义标签和过滤器了。

##代码布局
自定义标签和过滤器的代码必须在 Django 的 app 目录下。 app 必须要有 `templatetags`目录，这个目录放在 `views.py`, `models.py`同级别的目录中。自定义标签和过滤器的模块文件必须放置在`templatetags`目录下，而且`templatetags`目录必须添加`__init__.py`文件, 这样`templatetags`目录就会被认为是一个 python 包。

举个例子，假如你自定义标签和过滤器的文件为 `pollextras.py`, 你的 app 的目录结构应该类似如下：

```
	polls/
		models.py
		templatetags/
			__init__.py
			poll_extras.py
		views.py
```

这样，在自己的模板中，就可以通过如下语句使用自定义标签或者过滤器。

```
{% load poll_extras %}
```

注意：

1. 包含自定义标签的 app 必须在`INSTALLED_APPS`中（可以在settings.py中设定）。
2. `templatetags`包里面可以有任意多个自定义的模块。
3. ```{% load %}```语句应该 load 的是 python 的模块名，而不是 app 的名字。（例如，上述例子中，load 的是`poll_extras.py`而不是`polls`。）
4. 自定义标签的模块中，必须包含有名字为`register`的`template.Library`实例，这样这个模块下的标签和过滤器才会被注册。所以，一般在自己定义的模块中，需要加上：

```
from django import template
register = template.Library()
```

如果大家有兴趣的话，可以看一下 Django 默认的标签和过滤器的代码，分别为`django/template/defaulttags.py`和`django/template/defaultfilters.py`。

##创建自定义过滤器

##创建自定义标签

##参考链接
django document, https://docs.djangoproject.com/en/1.6/howto/custom-template-tags/
